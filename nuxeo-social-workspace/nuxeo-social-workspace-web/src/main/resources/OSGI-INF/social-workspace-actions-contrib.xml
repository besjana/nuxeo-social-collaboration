<?xml version="1.0"?>
<component name="org.nuxeo.ecm.social.workspace.actions">

  <require>org.nuxeo.ecm.platform.webengine.sites.actions</require>

  <extension target="org.nuxeo.ecm.platform.actions.ActionService"
    point="actions">

  <action
      id="BackToDashboard"
      link="${manageSocialWorkspaceActions.backToDashboard()}"
      label="label.social.workspace.backtodashboard"
      immediate="false"
      icon="/icons/back_to_social_workspace_dashboard.png"
      order="10">
      <category>SOCIAL_WORKSPACE_FULLSCREEN</category>
      <filter id="socialDocument">
        <rule grant="true">
          <facet>SocialDocument</facet>
        </rule>
      </filter>
    </action>

  <action
      id="GoToDMView"
      link="${navigationContext.navigateToDocument(currentDocument)}"
      label="label.social.workspace.gotodmview"
      immediate="false"
      icon="/icons/goto_dm.png"
      order="10">
      <category>SOCIAL_WORKSPACE_FULLSCREEN</category>
      <filter id="hasFullscreenView">
        <rule grant="true">
          <facet>SocialDocument</facet>
          <facet>SocialWorkspace</facet>
        </rule>
      </filter>
    </action>

  <action
      id="GoToFullScreenViewForDocument"
      link="${navigationContext.navigateToDocument(currentDocument, 'fullscreen')}"
      label="label.social.workspace.gotofullscreen"
      immediate="false"
      icon="/icons/fullscreen.png"
      order="10">
      <category>DOCUMENT_UPPER_ACTION</category>
      <filter id="hasFullscreenView">
        <rule grant="true">
          <facet>SocialDocument</facet>
          <facet>SocialWorkspace</facet>
        </rule>
      </filter>
    </action>

    <action id="newNewsItem" link="#{documentActions.createDocument('NewsItem')}"
      label="command.create.news.item" icon="/icons/action_add.gif">
      <category>SUBVIEW_UPPER_LIST</category>
      <filter id="newNewsItem">
        <rule grant="true">
          <permission>AddChildren</permission>
          <type>NewsItemsRoot</type>
        </rule>
      </filter>
    </action>

  <action
      id="SocialWorkspacesAdministration"
      link="view_admin-fragment.xhtml"
      label="label.social.workspace.administration"
      order="150">
      <category>NUXEO_ADMIN</category>
      <filter-id>only_for_manager</filter-id>
    </action>


  <action
      id="SocialWorkspacesAdministration"
      link="view_admin-fragment.xhtml"
      label="label.social.workspace.administration"
      order="150">
      <category>NUXEO_ADMIN</category>
      <filter-id>only_for_manager</filter-id>
    </action>

    <action
      id="SocialWorkspacesRequests"
      link="/incl/social_workspace_administration/social_workspace_requests.xhtml"
      label="label.socialworkspace.requests"
      order="10">
      <category>SocialWorkspacesAdministration_sub_tab</category>
      <filter-id>only_for_manager</filter-id>
    </action>

    <action id="AcceptSocialWorkspace" label="Accept" enabled="true" order="0" link="#{socialWorkspaceRequestActions.acceptSocialWorkspaces()}">
      <category>MODERATE_SOCIAL_WORKSPACE</category>
      <filter-id>only_for_manager</filter-id>
      <filter-id>moderate_social_workspace</filter-id>
    </action>
    <action id="RejectSocialWorkspace" label="Reject" enabled="true" order="0" link="#{socialWorkspaceRequestActions.rejectSocialWorkspaces()}">
      <category>MODERATE_SOCIAL_WORKSPACE</category>
      <filter-id>only_for_manager</filter-id>
      <filter-id>moderate_social_workspace</filter-id>
    </action>

    <action id="TAB_MANAGE_SOCIAL_WORKSPACE"
      link="/incl/tabs/social_workspace_groupManager_action_tabs.xhtml"
      order="100" label="action.view.group.management" icon="/icons/file.gif">
      <category>TAB_MANAGE_sub_tab</category>
      <filter-id>manage_social_workspace</filter-id>
    </action>

    <action id="TAB_MANAGE_REQUESTS" link="/incl/tabs/manage_requests_action_tab.xhtml"
      order="800" label="action.view.manage.requests" icon="/icons/file.gif">
      <category>TAB_MANAGE_sub_tab</category>
      <filter-id>manage_social_workspace</filter-id>
      <filter-id>workspace_administrator</filter-id>
    </action>

    <action id="REQUEST_ACCEPT" link="#{socialWorkspaceRequestActions.accept}"
      label="command.manage.requests.accept" icon="/icons/file.gif">
      <category>MANAGE_REQUESTS</category>
      <filter-id>isPendingRequest</filter-id>
    </action>

    <action id="REQUEST_REJECT" link="#{socialWorkspaceRequestActions.reject}"
      label="command.manage.requests.reject" icon="/icons/file.gif">
      <category>MANAGE_REQUESTS</category>
      <filter-id>isPendingRequest</filter-id>
    </action>

    <action id="TAB_SOCIAL_WORKSPACE_PRIVATE_DASHBOARD" link="/incl/tabs/social_workspace_private_dashboard.xhtml"
      order="5" label="action.view.private.dashboard" icon="/icons/file.gif">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>social_workspace</filter-id>
    </action>

    <action id="TAB_SOCIAL_WORKSPACE_PUBLIC_DASHBOARD" link="/incl/tabs/social_workspace_public_dashboard.xhtml"
      order="6" label="action.view.public.dashboard" icon="/icons/file.gif">
      <category>VIEW_ACTION_LIST</category>
      <filter-id>manage_social_workspace</filter-id>
      <filter-id>social_workspace</filter-id>
    </action>

  </extension>

  <extension target="org.nuxeo.ecm.platform.actions.ActionService"
    point="filters">

    <filter id="moderate_social_workspace">
      <rule grant="true">
        <condition>#{socialWorkspaceRequestActions.enableSocialWorkspaceActions()}</condition>
        <condition>#{documentsListsManager.isWorkingListEmpty("CURRENT_SELECTION") == false}</condition>
      </rule>
    </filter>

    <filter id="manage_social_workspace">
      <rule grant="true">
        <permission>Manage everything</permission>
        <facet>SocialWorkspace</facet>
      </rule>
    </filter>

    <filter id="social_workspace">
      <rule grant="true">
        <facet>SocialWorkspace</facet>
      </rule>
    </filter>

    <filter id="not_social_workspace">
      <rule grant="false">
        <facet>SocialWorkspace</facet>
      </rule>
    </filter>

    <filter id="isWebContainer" append="true">
      <rule grant="false">
        <facet>SocialWorkspace</facet>
      </rule>
    </filter>

    <filter id="denyFilesTab" append="true">
      <rule grant="false">
        <facet>SocialWorkspace</facet>
      </rule>
    </filter>

    <filter id="isPendingRequest">
      <rule grant="true">
        <condition>
          #{socialWorkspaceRequestActions.enableRequestActions()}
        </condition>
      </rule>
    </filter>

    <filter id="create" append="true">
      <rule grant="true">
        <permission>AddChildren</permission>
        <facet>SocialWorkspace</facet>
      </rule>
    </filter>

    <filter id="importFile" append="true">
      <rule grant="true">
        <permission>AddChildren</permission>
        <facet>SocialWorkspace</facet>
      </rule>
    </filter>

  </extension>
</component>
