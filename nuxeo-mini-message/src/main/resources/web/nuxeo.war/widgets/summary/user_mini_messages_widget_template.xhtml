<div xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:c="http://java.sun.com/jstl/core"
  id="#{widget.id}">

  <c:set var="userSchema" value="#{userManager.userSchemaName}" />
  <c:set var="userIdField" value="#{userManager.userIdField}" />

  <h3 class="summaryTitle">
    <h:outputText value="#{messages['mini.messages.tab.view']}" />
  </h3>

  <div class="gadgets-gadget-chrome gadgets gadget-user-mini-messages fullWidth"></div>

  <script type="text/javascript">
    jQuery('.gadget-user-mini-messages').openSocialGadget({
      baseURL: '#{baseURL}',
      language: '#{localeSelector.language}',
      gadgetDefs: [
        { specUrl: '#{gadgetsBaseURL}/site/gadgets/minimessages/minimessages.xml',
          title: '#{nxu:javaScriptEscape(messages['mini.messages.tab.view'])}',
          userPrefs: {
            miniMessagesStreamType: {
              value: 'fromActor'
            },
            actor: {
              value: '#{value[userSchema][userIdField]}'
            }
          },
          displayTitleBar: false,
          width: '100%'
        }
      ]
    });
  </script>

</div>
