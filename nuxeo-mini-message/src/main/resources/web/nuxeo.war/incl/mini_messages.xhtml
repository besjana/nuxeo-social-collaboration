<div xmlns="http://www.w3.org/1999/xhtml"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
  class="miniMessages">

  <a4j:outputPanel id="miniMessagesPanel" styleClass="miniMessagePanel" >
    <h:form id="newMiniMessageForm" class="newMiniMessageForm">
      <h:inputTextarea id="newMiniMessageText" value="#{miniMessageActions.newMessage}" rows="4" />
      <h:message styleClass="errorMessage" for="newMiniMessageText"
        id="newMiniMessageText_errorMessage" />
      <p class="newMiniMessageActions">
        <a4j:commandButton styleClass="button" value="#{messages['command.write']}"
          action="#{miniMessageActions.createNewMiniMessage()}"
          reRender="miniMessagesPanel" />
      </p>
    </h:form>

    <nxu:set var="contentViewName" value="mini_messages_for_user">
      <ui:decorate template="/incl/content_view.xhtml">
        <ui:define name="pageNavigationControls">
        </ui:define>
        <ui:define name="content_view_syndication_buttons">
      </ui:define>
      </ui:decorate>
    </nxu:set>

  </a4j:outputPanel>

  <script type="text/javascript">

    function updateMiniMessageCounter() {
      var delta = 140 - jQuery('.newMiniMessageForm textarea').val().length;
      var miniMessageCounter = jQuery('.miniMessageCounter');
      miniMessageCounter.text(delta);
      miniMessageCounter.toggleClass('warning', delta &lt; 5);
      if (delta &lt; 0) {
        jQuery('.writeMiniMessageButton').attr('disabled', 'disabled');
      } else {
        jQuery('.writeMiniMessageButton').removeAttr('disabled');
      }
    }

    jQuery(document).ready(function($) {
      updateMiniMessageCounter();
      $('.newMiniMessageForm textarea').keyup(updateMiniMessageCounter);
    });

  </script>


</div>
